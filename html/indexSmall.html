<!DOCTYPE html><html><head><script>document.addEventListener('contextmenu',event=>event.preventDefault());let leftMouseDown=false;let rightMouseDown=false;window.addEventListener('mouseup',e=>{leftMouseDown=false;rightMouseDown=false;});window.addEventListener('mousedown',e=>{if(e.buttons==1)leftMouseDown=true;if(e.buttons==2)rightMouseDown=true;});</script><style>body{background-color:rgb(90,90,90);} .btn-1{text-align:center;display:inline-block;padding:15px40px;border:1pxsolid #fff;cursor:pointer;letter-spacing:2px;position:relative;overflow:hidden;margin:10px0px;background-color:gray;color:white;width:90%;} .btn-1:before{content:"";position:absolute;height:150px;width:50px;background:#fff;left:-55px;top:-40px;transform:rotate(37deg);transition:all .3s;opacity:0.3;} .btn-1:hover:before{left:95%;}</style></head><body><div style="width:90%;margin:0auto;text-align:center;"><h1>LED-Matrix</h1><div><div style="display:block;float:left;width:200px;"><input type="color"id="colorPicker"class="btn-1"style="background:black;"></input><button style="height:50px;"class="btn-1"onclick="sendEditData()">Send</button><button style="height:50px;"class="btn-1"onclick="clearEditData()">Clear</button></div><div style="float:left;"><canvas onmousemove="drawEditCanvas(event)"style="background-color:lightgray;"id="editCanvas"width="650"height="650"></canvas></div><div><canvas style="background-color:lightgray;"id="liveCanvas"width="650"height="650"></canvas></div></div></div><script>class Box{constructor(x,y,w,h,i){this.x=x;this.y=y;this.w=w;this.h=h;this.index=i;this.r=0;this.g=0;this.b=0;}}let editCanvas=document.getElementById("editCanvas");let liveCanvas=document.getElementById("liveCanvas");let editContext=editCanvas.getContext("2d");let liveContext=liveCanvas.getContext("2d");const pixInRow=16;const pixInCol=16;const boxHeight=650/pixInRow;const boxWidth=650/pixInCol;let editBoxes=[];let liveBoxes=[];initWebSocket();function initWebSocket(){websocket=new WebSocket('ws://'+window.location.hostname+':81/');websocket.onmessage=function(evt){try{var reader=new FileReader();reader.addEventListener("loadend",function(){var byteBuffer=new Uint8Array(reader.result);liveBoxes.forEach(x=>{x.r=0;x.g=0;x.b=0;});for(let i=0;i<byteBuffer.length;i+=4){let box=liveBoxes.find(x=>x.index==byteBuffer[i]);box.r=byteBuffer[i+1];box.g=byteBuffer[i+2];box.b=byteBuffer[i+3];}drawLiveCanvas();});reader.readAsArrayBuffer(evt.data);}catch(e){console.error(e);console.log(evt.data);}}}function sendEditData(){let byteArray=new Uint8Array(4*8*256);let cnt=0;for(let b of editBoxes){if(!(b.r==0&&b.g==0&&b.b==0)){byteArray[cnt++]=b.index;byteArray[cnt++]=b.r;byteArray[cnt++]=b.g;byteArray[cnt++]=b.b;}}websocket.send(byteArray.slice(0,cnt));}function clearEditData(){editBoxes.forEach(x=>{x.r=0;x.g=0;x.b=0;});drawEditCanvas(null);}initButtonArrays();function initButtonArrays(){let multiplier=1;let odd=false;let step=-1;let multiCount=1;for(let j=0;j<pixInRow;j++){if(j%2==0){odd=false;multiplier=j+1;}else{odd=true;}for(let i=0;i<pixInCol;i++){let index=0;if(!odd)index=(pixInCol*multiplier)-1+i*step;else index=(pixInCol*multiplier)+i*step;editBoxes.push(new Box(i*boxWidth,j*boxHeight,boxWidth,boxHeight,index));liveBoxes.push(new Box(i*boxWidth,j*boxHeight,boxWidth,boxHeight,index));}step*=-1;}drawEditCanvas(null);}function drawLiveCanvas(){liveContext.clearRect(0,0,liveCanvas.width,liveCanvas.height);for(let b of liveBoxes){liveContext.fillStyle=`rgb(${b.r},${b.g},${b.b})`;liveContext.fillRect(b.x,b.y,boxWidth,boxHeight);}}function drawEditCanvas(evt){let pos=getMousePos(editCanvas,evt);for(let b of editBoxes){if(evt&&(leftMouseDown||rightMouseDown)&&pos.x>b.x&&pos.x<b.x+b.w&&pos.y>b.y&&pos.y<b.y+b.h){if(leftMouseDown){let rgb=hexToRgb(colorPicker.value);b.r=rgb.r;b.g=rgb.g;b.b=rgb.b;}else{b.r=0;b.g=0;b.b=0;}}editContext.fillStyle=`rgb(${b.r},${b.g},${b.b})`;editContext.fillRect(b.x,b.y,boxWidth,boxHeight);}}function getMousePos(c,evt){if(!evt)return null;let r=c.getBoundingClientRect();return{x:evt.clientX-r.left,y:evt.clientY-r.top};}function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null;}let colorPicker=document.getElementById('colorPicker');colorPicker.addEventListener('input',()=>{colorPicker.style.backgroundColor=colorPicker.value;});</script></script></body></html>